{% extends "base.html" %}
{% block title %}Your Favorites - MyUni{% endblock %}
{% block content %}
  <div class="hero mb-3">
    <div class="d-flex flex-column flex-md-row align-items-md-center justify-content-between gap-2">
      <div>
        <h1 class="mb-1">Your Favorites</h1>
        {% if user %}
          <p class="mb-0">Saved to your account.</p>
        {% else %}
          <p class="mb-0">Not logged in. Showing favorites from this browser only.</p>
        {% endif %}
      </div>
      <div class="d-flex gap-2">
        {% if user %}
          <button class="btn btn-light" onclick="(async()=>{ try{ const favs = MyUni.getFavorites(); const r = await fetch('/api/favorites',{method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({favorites:favs})}); if(r.ok){ alert('Synced favorites to your account.'); location.reload(); } else { alert('Failed to sync.'); } }catch(e){ alert('Failed to sync.'); } })()">Sync from this device</button>
        {% else %}
          <a class="btn btn-light" href="/login">Login to save</a>
          <a class="btn btn-primary" href="/signup">Create account</a>
        {% endif %}
      </div>
    </div>
  </div>

  {% if user %}
    {% if items and items|length > 0 %}
      <div class="row g-4">
        {% for uni in items %}
          <div class="col-12 col-sm-6 col-lg-4">
            <div class="card h-100 shadow-sm uni-card glass">
              <img src="{{ uni.local_image }}" class="card-img-top" alt="{{ uni.name }}" onerror="this.onerror=null;this.src='/static/images/default.svg'" />
              <div class="card-body d-flex flex-column">
                <h5 class="card-title">{{ uni.name }}</h5>
                <p class="text-muted small mb-2">{{ uni.city }}</p>
                <a class="btn btn-sm btn-primary mt-auto" href="/university/{{ uni.slug }}">Details</a>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="alert alert-info">No favorites yet. Browse universities and click “Save”.</div>
    {% endif %}
  {% else %}
    <div class="card">
      <div class="card-body">
        <h2 class="h6">Favorites on this device</h2>
        <div id="localFavs" class="row g-3"></div>
      </div>
    </div>
    <script>
      document.addEventListener('DOMContentLoaded', ()=>{
        const favs = new Set(MyUni.getFavorites());
        const container = document.getElementById('localFavs');
        const all = {{ (universities if universities else []) | default([], true) | tojson | safe }};
      });
    </script>
  {% endif %}
{% endblock %}
