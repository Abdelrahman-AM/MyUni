{% extends "base.html" %}

{% block title %}Universities in {{ city }} - MyUni{% endblock %}
{% block meta_description %}Browse universities in {{ city }}.{% endblock %}

{% block content %}
    <div class="hero mb-3">
      <div class="d-flex flex-column flex-md-row align-items-md-center justify-content-between gap-3">
        <div>
          <h1 class="mb-1">Universities in {{ city }}</h1>
          <p class="mb-0">Explore, filter, and save favorites.</p>
        </div>
        <div class="d-flex align-items-center gap-2">
          <a class="btn btn-light" href="/">Back Home</a>
          <span class="chip">Favorites <span data-fav-count>0</span></span>
        </div>
      </div>
    </div>

    <form class="row gy-2 gx-2 align-items-center mb-3" method="get" action="/universities">
        <input type="hidden" name="city" value="{{ city }}" />
        <div class="col-12 col-md-6">
            <input type="search" class="form-control" placeholder="Search by name or description" name="q" value="{{ q }}" />
        </div>
        <div class="col-8 col-md-4">
            <select class="form-select" name="program">
                <option value="">All programs</option>
                {% for p in program_options %}
                    <option value="{{ p }}" {% if program==p %}selected{% endif %}>{{ p }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-4 col-md-2 d-grid">
            <button class="btn btn-primary" type="submit">Filter</button>
        </div>
    </form>

    <div class="text-muted small mb-3">{{ total_count }} result{% if total_count!=1 %}s{% endif %}</div>

    {% if universities and universities|length > 0 %}
    <div class="row g-4">
        {% for uni in universities %}
        <div class="col-12 col-sm-6 col-lg-4 reveal" data-reveal-delay="{{ (loop.index0 % 3) * 120 }}">
          <div class="card h-100 shadow-sm uni-card glass">
            <img src="{{ uni.display_image }}" onerror="this.onerror=null;this.src='/static/images/default.svg'" class="card-img-top" alt="{{ uni.name }}" loading="lazy">
            <div class="card-body d-flex flex-column">
              <h5 class="card-title">{{ uni.name }}</h5>
              <p class="card-text text-muted small mb-2">{{ uni.city }}</p>
              <div class="mb-3">
                {% for p in uni.programs[:3] %}
                <span class="badge text-bg-light border me-1 mb-1">{{ p }}</span>
                {% endfor %}
              </div>
              <div class="d-flex gap-2 mt-auto">
                <button class="btn btn-sm btn-outline-danger" data-fav-btn data-slug="{{ uni.slug }}" onclick="MyUni.toggleFavorite('{{ uni.slug }}')">â™¡ Save</button>
                <a href="/university/{{ uni.slug }}" class="btn btn-sm btn-primary">Details</a>
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
        <div class="alert alert-warning mt-4" role="alert">
            No universities found for {{ city }}.
        </div>
    {% endif %}

    {% if total_pages and total_pages > 1 %}
    <nav class="mt-4">
      <ul class="pagination">
        <li class="page-item {% if page<=1 %}disabled{% endif %}"><a class="page-link" href="?city={{ city | urlencode }}&q={{ q | urlencode }}&program={{ program | urlencode }}&page={{ page-1 }}">Previous</a></li>
        <li class="page-item disabled"><span class="page-link">Page {{ page }} of {{ total_pages }}</span></li>
        <li class="page-item {% if page>=total_pages %}disabled{% endif %}"><a class="page-link" href="?city={{ city | urlencode }}&q={{ q | urlencode }}&program={{ program | urlencode }}&page={{ page+1 }}">Next</a></li>
      </ul>
    </nav>
    {% endif %}
{% endblock %}
